pico-8 cartridge // http://www.pico-8.com
version 32
__lua__
#include platformer.lua

function new_sphere(pos)
	local actor=new_actor(49, pos)
	local anim=new_anim(actor, 4, 5)
	local movement=new_acc_movement(actor, 0.25, 1.1, 1.1, true)
	return {actor=actor, anim=anim, movement=movement}
end

function _init()
    local player_actor=new_actor(1, {x=20, y=20})
    local player_movement=new_acc_movement(player_actor, 0.05, 1, 2)
    local walk=new_anim(player_actor, 4, 4)
    local jump=new_anim(player_actor, 1, 1, 17)
    local player_text=""
    player_timer=new_timer(120, function()
        player_text=""
        player_timer:reset()
    end)
    game=new_game(
        new_player(
            player_movement,
            function()
                if not player_actor.grounded then
                    jump:step()
                elseif abs(player_movement.dx)>0.1 then
                    walk:step()
                else
                    walk:reset()
                    walk:step()
                end
            end,
            function(obj_data)
                player_text="buzz!"
            end
        ),
        new_objects({
            {tile=49, new_obj=new_sphere, move=move_across_path},
        }),
        {},
        function(view)
            local offset=view:get_offset()
            print(player_text, player_actor.pos.x-5+offset.x, player_actor.pos.y-10+offset.y)
        end
    )
end

function _update60()
	game:update()
    player_timer:step()
end

function _draw()
	game:draw()
end
__gfx__
00000000006060600060606000606060006060600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000060606060606060606060606060606060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700006000600060006000600060006000600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000060060600600606006006060060060600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000600000006000000060000000600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000600000060000000600000000600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000006060000006600000066000000060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000006060000006600000600600000660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000006060600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000060606060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000006000600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000060060600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000006060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000060600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000099999900000000000000000000000000999999005151550000000000000000000000000000000000000000000000000000000000000000000000000
00000000940404040110001000c00000000000009404040451010102000000000000000000000000000000000000000000000000000000000000000000000000
00000000904000090000000000000000010000009090904010100002000000000000000000000000000000000000000000000000000000000000000000000000
000000009009404000101000000000000100c0000904040050029020000000000000000000000000000000000000000000000000000000000000000000000000
00000000940440090000000000001100010000000000000051014002000000000000000000000000000000000000000000000000000000000000000000000000
00000000904004040001110000000000010000100000000010200104000000000000000000000000000000000000000000000000000000000000000000000000
00000000900400090c00000000000000000000100000000050020002000000000000000000000000000000000000000000000000000000000000000000000000
00000000049094900000000000000000000000000000000001202120000000000000000000000000000000000000000000000000000000000000000000000000
0000000000cc660000cc6600007c660000cc66000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000c0700600c0700600c0700600c0700600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000c0706606c6706606c6709606707066060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000c0070766c067076670a9a766c0a7a7660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000670706066a076a066a079a06670906060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000c0707006c0607076c0697a76c07090060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000060606c0060a06c0060a0670060606c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000c6c60000ccc60000c7c60000c6c6000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000000000000000000000000000000000000000000000000000000000000000000680808002060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
2100000000000000000000000000000000000000000000000000230000000021000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2100000000000000000000000000000000002400242121220000000024000021000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2100000000000000000000240000000000000000212626262622220000000021000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2100240023000000000000000000230000000023212626002400000023000021000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2100000000000000000023240022000000000000002622000000000000000021000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2623000000002400000000262126240022000000232600320000003200000021000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2600000000262600220000232626260000000032000000312300003200000026000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2100230022262100000000000000000000220032000000320000003200000021000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2100000000242300240022000022000000002232002300320024003200240026000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2600000024002222000032313232323232000031000000320000003100000021000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2100240000000000000000230000000000000032000000320000003200000021000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2126000000000000000000002400220022000000000000320000223200000021000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2126260021212121210000000000000000000000002500240000003200000026000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2121212126262621212121212121212126262100000000000025000000240021260000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000262626212626262626002626002626262100240000000000000000002621260000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000026262621260000260000262600262100000025240022002121212121260000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000026000026000000002100230000000000002126262626260000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000002100250000220023002100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000002600000000212121212126000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000262600222300212600262600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000026262121212126212600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000026262600260026262121000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000260026210000212100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
